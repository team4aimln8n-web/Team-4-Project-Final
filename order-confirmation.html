<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Confirmed - ShopHub</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="chatbot.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">üõçÔ∏è ShopHub</a>
            
            <ul class="nav-menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="products.html">Products</a></li>
                <li><a href="orders.html">My Orders</a></li>
            </ul>
            
            <div class="nav-icons">
                <a href="cart.html" class="nav-icon">
                    üõí
                    <span id="cart-badge" class="cart-badge" style="display: none;">0</span>
                </a>
                <a href="login.html" id="login-link" class="nav-icon">üë§</a>
                <a href="#" id="user-link" class="nav-icon" style="display: none;" title="Profile">üë§</a>
                <button id="logout-btn" class="nav-icon" style="display: none; background: none; border: none; color: white; cursor: pointer;">Logout</button>
            </div>
            
            <button class="mobile-menu-btn">‚ò∞</button>
        </div>
    </nav>

    <!-- Order Confirmation Section -->
    <div class="container">
        <div class="form-container" style="max-width: 800px; text-align: center;">
            <!-- Success Icon -->
            <div style="font-size: 5em; margin-bottom: 20px;">‚úÖ</div>
            
            <h1 style="color: var(--success-green); margin-bottom: 15px;">Order Placed Successfully!</h1>
            <p style="font-size: 1.2em; color: var(--text-light); margin-bottom: 40px;">
                Thank you for your order. We've received your order and will process it soon.
            </p>

            <!-- Order Details -->
            <div id="order-details-container">
                <!-- Order details will be loaded here -->
            </div>

            <!-- Action Buttons -->
            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 40px; flex-wrap: wrap;">
                <a href="orders.html" class="btn-primary" style="width: auto; display: inline-block;">
                    View My Orders
                </a>
                <a href="products.html" class="btn-secondary" style="width: auto; display: inline-block;">
                    Continue Shopping
                </a>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-links">
                <a href="index.html">Home</a>
                <a href="products.html">Products</a>
                <a href="orders.html">My Orders</a>
                <a href="cart.html">Cart</a>
                <a href="login.html">Login</a>
            </div>
            <p>&copy; 2024 ShopHub. All rights reserved.</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="api.js"></script>
    <script>
        // Load order details
        async function loadOrderDetails() {
            const orderId = getUrlParameter('order_id');
            const orderNumber = getUrlParameter('order_number');

            const container = document.getElementById('order-details-container');

            if (!orderId || !orderNumber) {
                container.innerHTML = `
                    <div class="alert alert-error">
                        <span>‚ö†Ô∏è</span>
                        <span>Order information not found. Please check your orders page.</span>
                    </div>
                `;
                return;
            }

            try {
                const response = await fetch(`${API_ENDPOINTS.GET_ORDER_DETAILS}?order_id=${orderId}`);
                
                if (!response.ok) {
                    throw new Error('Failed to fetch order details');
                }

                const order = await response.json();

                displayOrderDetails(order);

            } catch (error) {
                console.error('Error loading order details:', error);
                
                // Show basic order info even if detailed fetch fails
                container.innerHTML = `
                    <div style="background: var(--light-gray); padding: 30px; border-radius: 12px; text-align: left;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <strong style="color: var(--primary-black); display: block; margin-bottom: 5px;">Order Number</strong>
                                <span style="font-size: 1.2em; font-weight: 600;">${orderNumber}</span>
                            </div>
                            <div>
                                <strong style="color: var(--primary-black); display: block; margin-bottom: 5px;">Payment Method</strong>
                                <span>Cash on Delivery (COD)</span>
                            </div>
                        </div>

                        <div class="alert alert-info">
                            <span>‚ÑπÔ∏è</span>
                            <span>You will receive a confirmation email shortly with your order details.</span>
                        </div>
                    </div>
                `;
            }
        }

        // Display order details
        function displayOrderDetails(order) {
            const container = document.getElementById('order-details-container');

            const orderTotal = order.items ? 
                order.items.reduce((sum, item) => sum + (item.price_at_purchase * item.quantity), 0) : 
                order.total_amount;

            container.innerHTML = `
                <div style="background: var(--light-gray); padding: 30px; border-radius: 12px; text-align: left;">
                    <h2 style="margin-bottom: 20px; color: var(--primary-black);">Order Details</h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div>
                            <strong style="color: var(--primary-black); display: block; margin-bottom: 5px;">Order Number</strong>
                            <span style="font-size: 1.2em; font-weight: 600;">${order.order_number}</span>
                        </div>
                        <div>
                            <strong style="color: var(--primary-black); display: block; margin-bottom: 5px;">Order Date</strong>
                            <span>${formatDate(order.created_at)}</span>
                        </div>
                        <div>
                            <strong style="color: var(--primary-black); display: block; margin-bottom: 5px;">Status</strong>
                            <span class="order-status status-${order.status}">${order.status}</span>
                        </div>
                        <div>
                            <strong style="color: var(--primary-black); display: block; margin-bottom: 5px;">Total Amount</strong>
                            <span style="font-size: 1.2em; font-weight: 600;">${formatPrice(orderTotal)}</span>
                        </div>
                    </div>

                    ${order.items && order.items.length > 0 ? `
                        <div style="margin-bottom: 30px;">
                            <h3 style="margin-bottom: 15px; color: var(--primary-black);">Order Items</h3>
                            ${order.items.map(item => `
                                <div style="display: flex; justify-content: space-between; padding: 15px; background: var(--white); border-radius: 8px; margin-bottom: 10px;">
                                    <div>
                                        <div style="font-weight: 600; margin-bottom: 5px;">${item.product_name || item.name}</div>
                                        <div style="font-size: 0.9em; color: var(--text-light);">
                                            Quantity: ${item.quantity} √ó ${formatPrice(item.price_at_purchase)}
                                        </div>
                                    </div>
                                    <div style="font-weight: bold;">
                                        ${formatPrice(item.price_at_purchase * item.quantity)}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}

                    <div style="margin-bottom: 30px;">
                        <h3 style="margin-bottom: 15px; color: var(--primary-black);">Shipping Information</h3>
                        <div style="background: var(--white); padding: 20px; border-radius: 8px;">
                            ${order.shipping_address.full_name ? `<p><strong>Name:</strong> ${order.shipping_address.full_name}</p>` : ''}
                            <p><strong>Address:</strong> ${order.shipping_address.street}</p>
                            <p><strong>City:</strong> ${order.shipping_address.city}</p>
                            ${order.shipping_address.state ? `<p><strong>State:</strong> ${order.shipping_address.state}</p>` : ''}
                            <p><strong>Postal Code:</strong> ${order.shipping_address.postal_code}</p>
                            <p><strong>Phone:</strong> ${order.phone_number}</p>
                            ${order.notes ? `<p><strong>Delivery Notes:</strong> ${order.notes}</p>` : ''}
                        </div>
                    </div>

                    <div>
                        <h3 style="margin-bottom: 15px; color: var(--primary-black);">Payment Method</h3>
                        <div style="background: var(--white); padding: 20px; border-radius: 8px;">
                            <p><strong>Cash on Delivery (COD)</strong></p>
                            <p style="color: var(--text-light); margin-top: 10px;">
                                üíµ You will pay <strong>${formatPrice(orderTotal)}</strong> in cash when your order is delivered.
                            </p>
                        </div>
                    </div>
                </div>

                <div class="alert alert-success mt-20">
                    <span>‚úâÔ∏è</span>
                    <span>A confirmation email has been sent to your registered email address.</span>
                </div>

                <div class="alert alert-info mt-20">
                    <span>üì¶</span>
                    <span>You can track your order status from the "My Orders" page.</span>
                </div>
            `;
        }

        // Load order details when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadOrderDetails();
        });
    </script>
    <script src="chatbot.js"></script>
</body>
</html>